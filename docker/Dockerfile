FROM python:3.13-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# System deps
RUN apt-get update && apt-get install -y --no-install-recommends build-essential libpq-dev && rm -rf /var/lib/apt/lists/*

# Copy app
COPY ./app /app/app
COPY ./data /app/data
COPY ./docker /app/docker
COPY ./var /app/var
COPY ./requirements.txt /app/requirements.txt

# # Install Python deps directly (no requirements.txt)
# RUN pip install --no-cache-dir fastapi uvicorn[standard] sqlalchemy psycopg2-binary pymysql pymongo python-multipart \
#     langchain langgraph langchain-openai


# Instal dependencies
RUN pip install --no-cache-dir -r /app/requirements.txt


EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
